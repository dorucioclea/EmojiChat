{
  "code": "import { GlobalObject } from \"@wessberg/globalobject\";\r\nimport { eventUtil } from \"../Services\";\r\nimport { Config } from \"@wessberg/environment\";\r\nimport { RouteHistory } from \"./RouteHistory\";\r\nimport { EventName } from \"../../EventName/EventName\";\r\nexport class NavigationUtil {\r\n    constructor(routes) {\r\n        this.routeToPageInstanceMap = new Map();\r\n        this.routeHistory = new RouteHistory(this);\r\n        this.setRoutes(routes);\r\n        this.navigate(location.pathname).then();\r\n    }\r\n    async onNavigateTo(route, data) {\r\n        await this.attachRoute(route, data);\r\n    }\r\n    async navigate(path, data) {\r\n        if (Config.DEBUG)\r\n            console.log(\"navigation intent:\", path);\r\n        if (this.isCurrentRoute(path))\r\n            return;\r\n        const route = this.getRoute(path);\r\n        if (route == null)\r\n            throw new ReferenceError(`${this.constructor.name} could not find a route for location: ${path}`);\r\n        await this.routeHistory.addState(route, data);\r\n    }\r\n    async back() {\r\n        await this.routeHistory.back();\r\n    }\r\n    isCurrentRoute(path) {\r\n        if (this.currentPageInstance == null)\r\n            return false;\r\n        const ctor = this.currentPageInstance.constructor;\r\n        return ctor.testRoute(path);\r\n    }\r\n    getRoute(path) {\r\n        return this.routes.get(path) || this.matchPathWithRoutes(path);\r\n    }\r\n    matchPathWithRoutes(path) {\r\n        for (const entry of this.routes.entries()) {\r\n            const [, route] = entry;\r\n            if (route.page.testRoute(path)) {\r\n                // Duplicate the path as an alias for O(1) lookups\r\n                this.routes.set(path, route);\r\n                return route;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n    async whenReady() {\r\n        if (this.frame != null)\r\n            return;\r\n        const { detail } = await eventUtil.waitFor(EventName.ATTACHED_FRAME, GlobalObject);\r\n        this.frame = detail;\r\n    }\r\n    async attachRoute(route, data) {\r\n        await this.whenReady();\r\n        if (this.isCurrentRoute(route.path))\r\n            return;\r\n        const instance = this.getInstance(route);\r\n        const old = this.currentPageInstance;\r\n        this.currentPageInstance = instance;\r\n        await Promise.all([\r\n            instance.didBecomeVisible(data),\r\n            old != null ? old.didBecomeInvisible() : Promise.resolve()\r\n        ]);\r\n    }\r\n    getInstance(route) {\r\n        if (route.page == null)\r\n            throw new ReferenceError(`${this.constructor.name} could not find a page for route: ${route.path}`);\r\n        let instance = this.routeToPageInstanceMap.get(route.page);\r\n        if (instance == null) {\r\n            instance = new route.page();\r\n            this.frame.appendChild(instance);\r\n            this.routeToPageInstanceMap.set(route.page, instance);\r\n        }\r\n        return instance;\r\n    }\r\n    setRoutes(routes) {\r\n        const mapped = routes.map(route => [route.path, route]);\r\n        this.routes = new Map(mapped);\r\n    }\r\n}\r\n//# sourceMappingURL=NavigationUtil.js.map",
  "map": {
    "version": 3,
    "file": "NavigationUtil.js",
    "sourceRoot": "",
    "sources": [
      "../../../../src/Service/NavigationUtil/NavigationUtil.ts"
    ],
    "names": [],
    "mappings": "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"
  }
}
